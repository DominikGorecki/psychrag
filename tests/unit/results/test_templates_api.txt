================================================= test session starts =================================================
platform win32 -- Python 3.12.2, pytest-9.0.1, pluggy-1.6.0
rootdir: C:\code\python\psychRAG-test
configfile: pyproject.toml
plugins: anyio-4.11.0, Faker-38.2.0, langsmith-0.4.47, logfire-4.15.1, html-4.1.1, markdown-docs-0.9.0, metadata-3.1.1
collected 26 items

tests\unit\test_templates_api.py .................F........                                                      [100%]

====================================================== FAILURES =======================================================
_______________________________ TestUpdateTemplate.test_update_invalid_template_format ________________________________

self = <test_templates_api.TestUpdateTemplate object at 0x000001CBA1305F10>
client = <starlette.testclient.TestClient object at 0x000001CBA1504950>
sample_templates = [<PromptTemplate(id=204, function_tag='test_function', version=1, active=True)>, <PromptTemplate(id=205, function_tag=...unction', version=2, active=False)>, <PromptTemplate(id=206, function_tag='another_function', version=1, active=True)>]

    def test_update_invalid_template_format(self, client, sample_templates):
        """Test validation for invalid PromptTemplate format."""
        response = client.put(
            "/settings/templates/test_function/1",
            json={
                "template_content": "Invalid {{"
            }
        )
    
>       assert response.status_code == 422  # Validation error
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       assert 200 == 422
E        +  where 200 = <Response [200 OK]>.status_code

tests\unit\test_templates_api.py:332: AssertionError
================================================== warnings summary ===================================================
tests/unit/test_templates_api.py: 150 warnings
  C:\code\python\psychRAG-test\venv\Lib\site-packages\sqlalchemy\sql\schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=============================================== short test summary info ===============================================
FAILED tests/unit/test_templates_api.py::TestUpdateTemplate::test_update_invalid_template_format - assert 200 == 422
===================================== 1 failed, 25 passed, 150 warnings in 12.31s =====================================
